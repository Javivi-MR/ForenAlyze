{% extends "base.html" %}

{% block title %}Upload file Â· ForenHub{% endblock %}

{% block subnav %}
<nav class="subnav">
  <div class="container-fluid">
    <ul class="nav justify-content-center">
      <li class="nav-item">
        <a class="nav-link" href="/dashboard">Dashboard</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/files">Files</a>
      </li>
      <li class="nav-item ms-auto">
        <a class="nav-link active" href="/upload">Upload file</a>
      </li>
    </ul>
  </div>
</nav>
{% endblock %}

{% block content %}
<div class="container py-5 dashboard-page">
  <div class="row justify-content-center">
    <div class="col-lg-7">
      <div class="card bg-dark text-light shadow-sm border-0" style="max-width:480px;margin:auto;">
        <div class="card-body d-flex flex-column align-items-center justify-content-center" style="min-height:320px;">
          <form id="upload-form" action="/upload" method="post" enctype="multipart/form-data" class="w-100">
            <div id="drop-area" class="upload-drop-area mb-3 d-flex flex-column align-items-center justify-content-center">
              <div class="upload-icon mb-3">
                <!-- SVG de upload personalizado -->
                <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                  <path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2" />
                  <path d="M7 9l5 -5l5 5" />
                  <path d="M12 4l0 12" />
                </svg>
              </div>
              <input type="file" id="file-input" name="file" class="d-none" required>
              <button type="button" id="choose-file-btn" class="btn btn-outline-primary px-4 py-2 mb-2">
                Choose file
              </button>
              <div class="small text-muted mb-2 text-center">
                Drag and drop your file here or click "Choose file".<br>
                <span class="text-light">Allowed extensions:</span> exe, pdf, doc(x), xls(x), images, wav<br>
                <span class="text-light">Maximum size:</span> 100 MB
              </div>
            </div>
            <div class="d-flex justify-content-center">
              <button type="submit" class="btn btn-primary px-4" style="min-width:140px;">
                Upload and analyse
              </button>
            </div>
          </form>
        </div>
      </div>
      <div class="text-center small text-muted mt-4" style="max-width:480px;margin:auto;">
        <span class="fw-semibold">Do not upload personal or confidential information.</span>
        Files will be analysed automatically and stored securely.
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.upload-drop-area {
  border: 2px dashed #3b82f6;
  border-radius: 12px;
  background: #181f2a;
  padding: 32px 0 24px 0;
  transition: border-color 0.2s;
  cursor: pointer;
  min-height: 180px;
  width: 100%;
}
.upload-drop-area.dragover {
  border-color: #22c55e;
  background: #23293a;
}
.upload-icon svg {
  display: block;
  margin: auto;
}
</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const dropArea = document.getElementById("drop-area");
  const fileInput = document.getElementById("file-input");
  const chooseBtn = document.getElementById("choose-file-btn");
  const form = document.getElementById("upload-form");

  // "Choose file" button
  chooseBtn.addEventListener("click", () => fileInput.click());

  // Drag & drop
  dropArea.addEventListener("dragover", (e) => {
    e.preventDefault();
    dropArea.classList.add("dragover");
  });
  dropArea.addEventListener("dragleave", (e) => {
    dropArea.classList.remove("dragover");
  });
  dropArea.addEventListener("drop", (e) => {
    e.preventDefault();
    dropArea.classList.remove("dragover");
    if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
      fileInput.files = e.dataTransfer.files;
      chooseBtn.textContent = e.dataTransfer.files[0].name;
    }
  });

  // Show selected file name
  fileInput.addEventListener("change", () => {
    if (fileInput.files.length > 0) {
      chooseBtn.textContent = fileInput.files[0].name;
    } else {
      chooseBtn.textContent = "Choose file";
    }
  });

  // Client-side validation
  const MAX_FILE_SIZE = 100 * 1024 * 1024;
  const ALLOWED_EXTENSIONS = [
    "exe", "pdf", "doc", "docx", "xls", "xlsx",
    "png", "jpg", "jpeg", "gif", "bmp", "wav", "mp3"
  ];
  form.addEventListener("submit", (e) => {
    const file = fileInput.files[0];
    if (!file) {
      e.preventDefault();
      Swal.fire({
        icon: "error",
        title: "Invalid file",
        text: "You must select a file to upload.",
        background: "#181f2a",
        color: "#e5e7eb",
        confirmButtonColor: "#3b82f6",
      });
      return;
    }
    const ext = (file.name.split(".").pop() || "").toLowerCase();
    if (!ALLOWED_EXTENSIONS.includes(ext)) {
      e.preventDefault();
      Swal.fire({
        icon: "error",
        title: "Invalid file",
        text: "The selected file type is not allowed.",
        background: "#181f2a",
        color: "#e5e7eb",
        confirmButtonColor: "#3b82f6",
      });
      return;
    }
    if (file.size > MAX_FILE_SIZE) {
      e.preventDefault();
      Swal.fire({
        icon: "error",
        title: "File too large",
        text: "The file exceeds the maximum allowed size of 100 MB.",
        background: "#181f2a",
        color: "#e5e7eb",
        confirmButtonColor: "#3b82f6",
      });
      return;
    }
  });
});
</script>
{% endblock %}
